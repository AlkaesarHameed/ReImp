import{a as e}from"./chunk-QB55GBCV.js";import{d}from"./chunk-TD2OOY6M.js";import{e as g}from"./chunk-R72WXHZK.js";import{Ac as l,D as n,V as a,Z as h,d as u,da as m,m as o,ya as c}from"./chunk-UUFN4DK2.js";var p={admin:{id:"usr-001",username:"admin",email:"admin@claims.local",role:"administrator",permissions:["claims:read","claims:write","claims:create","claims:update","claims:approve","admin:users","admin:settings","admin:access","reports:view"],firstName:"System",lastName:"Administrator"},processor:{id:"usr-002",username:"processor",email:"processor@claims.local",role:"claims_processor",permissions:["claims:read","claims:write","claims:create","claims:update"],firstName:"Claims",lastName:"Processor"},supervisor:{id:"usr-003",username:"supervisor",email:"supervisor@claims.local",role:"supervisor",permissions:["claims:read","claims:write","claims:create","claims:update","claims:approve","reports:view"],firstName:"Team",lastName:"Supervisor"}},A=(()=>{class t{http=m(g);router=m(d);useMockAuth=!e.production;userSignal=c(null);loadingSignal=c(!1);sessionTimeoutId=null;lastActivityTime=Date.now();user=this.userSignal.asReadonly();loading=this.loadingSignal.asReadonly();isLoggedIn=l(()=>this.userSignal()!==null);userRole=l(()=>this.userSignal()?.role??null);userPermissions=l(()=>this.userSignal()?.permissions??[]);initializeAuth(){if(this.loadingSignal.set(!0),this.useMockAuth){let s=sessionStorage.getItem("mock_user");s&&(this.userSignal.set(JSON.parse(s)),this.startSessionMonitoring()),this.loadingSignal.set(!1);return}this.http.get(`${e.apiUrl}/auth/me`,{withCredentials:!0}).pipe(a(s=>{this.userSignal.set(s),this.startSessionMonitoring()}),n(()=>(this.userSignal.set(null),o(null)))).subscribe(()=>{this.loadingSignal.set(!1)})}login(s){return this.loadingSignal.set(!0),this.useMockAuth?this.mockLogin(s):this.http.post(`${e.apiUrl}/auth/login`,s,{withCredentials:!0}).pipe(a(i=>{this.userSignal.set(i.user),this.startSessionMonitoring(),this.loadingSignal.set(!1)}),n(i=>{throw this.loadingSignal.set(!1),i}))}mockLogin(s){let i=p[s.username.toLowerCase()];return!i||s.password!=="demo123"?(this.loadingSignal.set(!1),new u(r=>{setTimeout(()=>{r.error(new Error("Invalid username or password. Use: admin/demo123, processor/demo123, or supervisor/demo123"))},500)})):new u(r=>{setTimeout(()=>{sessionStorage.setItem("mock_user",JSON.stringify(i)),this.userSignal.set(i),this.startSessionMonitoring(),this.loadingSignal.set(!1),r.next({user:i,expiresAt:new Date(Date.now()+15*60*1e3).toISOString()}),r.complete()},500)})}logout(){return this.useMockAuth?(sessionStorage.removeItem("mock_user"),this.clearSession(),this.router.navigate(["/auth/login"]),o(void 0)):this.http.post(`${e.apiUrl}/auth/logout`,{},{withCredentials:!0}).pipe(a(()=>{this.clearSession(),this.router.navigate(["/auth/login"])}),n(()=>(this.clearSession(),this.router.navigate(["/auth/login"]),o(void 0))))}isAuthenticated(){return this.userSignal()!==null}hasPermission(s){return(this.userSignal()?.permissions??[]).includes(s)}hasRole(...s){let i=this.userSignal()?.role;return i!==null&&s.includes(i)}recordActivity(){this.lastActivityTime=Date.now()}startSessionMonitoring(){this.stopSessionMonitoring(),this.sessionTimeoutId=setInterval(()=>{Date.now()-this.lastActivityTime>=e.sessionTimeout&&(console.warn("Session timeout due to inactivity"),this.logout().subscribe())},60*1e3),this.setupActivityTracking()}stopSessionMonitoring(){this.sessionTimeoutId&&(clearInterval(this.sessionTimeoutId),this.sessionTimeoutId=null)}setupActivityTracking(){["mousedown","keydown","scroll","touchstart"].forEach(i=>{document.addEventListener(i,()=>this.recordActivity(),{passive:!0})})}clearSession(){this.userSignal.set(null),this.stopSessionMonitoring()}static \u0275fac=function(i){return new(i||t)};static \u0275prov=h({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();export{A as a};
